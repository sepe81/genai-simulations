<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>üöÄ Raketen-Mathe - 1x1 im Weltall</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: 'Comic Sans MS', cursive, Arial, sans-serif;
            background: #000;
        }
        #gameCanvas {
            display: block;
            background: linear-gradient(to bottom, #000000 0%, #0a0a2e 50%, #16213e 100%);
        }
        #controls {
            position: absolute;
            top: 20px;
            left: 20px;
            color: white;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 10px;
            font-size: 16px;
            border: 2px solid #FFD700;
        }
        #stats {
            position: absolute;
            top: 20px;
            right: 20px;
            color: white;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 10px;
            font-size: 20px;
            text-align: right;
            border: 2px solid #FFD700;
        }
        #levelDisplay {
            font-size: 28px;
            font-weight: bold;
            color: #FFD700;
            margin-bottom: 10px;
        }
        #scoreDisplay {
            font-size: 24px;
            color: #90EE90;
        }
        #answerPanel {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 20px 30px;
            border-radius: 15px;
            border: 3px solid #FFD700;
            display: none;
        }
        #questionText {
            color: #FFD700;
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }
        #answerButtons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        #keyboardInputDisplay {
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            font-size: 36px;
            font-weight: bold;
            padding: 10px 25px;
            border-radius: 10px;
            margin-bottom: 15px;
            text-align: center;
            min-width: 100px;
            border: 3px solid #FFD700;
        }
        #inputHint {
            color: #90EE90;
            font-size: 14px;
            margin-top: 10px;
            text-align: center;
        }
        .answerBtn {
            padding: 15px 30px;
            font-size: 28px;
            font-weight: bold;
            border: 3px solid #4CAF50;
            border-radius: 10px;
            background: linear-gradient(to bottom, #5cb85c, #4CAF50);
            color: white;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
            transition: all 0.2s;
        }
        .answerBtn:hover {
            background: linear-gradient(to bottom, #6cc76c, #5cb85c);
            transform: translateY(-3px);
            box-shadow: 0 7px 20px rgba(76, 175, 80, 0.6);
        }
        .answerBtn:active {
            transform: translateY(0);
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            border: none;
            border-radius: 8px;
            background: #4CAF50;
            color: white;
            font-weight: bold;
            font-size: 16px;
        }
        button:hover {
            background: #45a049;
        }
        #message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 215, 0, 0.95);
            color: #333;
            padding: 30px 50px;
            border-radius: 20px;
            font-size: 48px;
            font-weight: bold;
            display: none;
            box-shadow: 0 10px 40px rgba(255, 215, 0, 0.8);
            z-index: 1000;
            text-align: center;
        }
        .combo {
            position: absolute;
            font-size: 36px;
            font-weight: bold;
            color: #FFD700;
            text-shadow: 0 0 10px #FFD700;
            pointer-events: none;
            animation: comboFloat 1s ease-out forwards;
            z-index: 100;
        }
        @keyframes comboFloat {
            0% {
                transform: translateY(0) scale(0.5);
                opacity: 1;
            }
            100% {
                transform: translateY(-80px) scale(1.2);
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>

    <div id="controls">
        <button onclick="resetGame()">üîÑ Neues Spiel (R)</button>
        <div style="margin-top: 10px; font-size: 14px;">W√§hle die richtige Antwort!</div>
        <div style="font-size: 14px;">Schnell = Bonus!</div>
    </div>

    <div id="stats">
        <div id="levelDisplay">Level 1: 1er-5er Reihe</div>
        <div id="scoreDisplay">‚≠ê Punkte: <span id="score">0</span></div>
        <div style="font-size: 18px; margin-top: 5px;">Combo: <span id="combo">0</span>x</div>
        <div style="font-size: 16px;">Treffer: <span id="hits">0</span></div>
    </div>

    <div id="answerPanel">
        <div id="questionText"></div>
        <div id="keyboardInputDisplay">_</div>
        <div id="inputHint">Tippe die Antwort oder klicke auf einen Button | Enter = Best√§tigen | Backspace = L√∂schen</div>
        <div id="answerButtons"></div>
    </div>

    <div id="message"></div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        canvas.width = 1000;
        canvas.height = 700;

        // Game state
        let rockets = [];
        let stars = [];
        let planets = [];
        let explosions = [];
        let currentLevel = 1;
        let score = 0;
        let hits = 0;
        let combo = 0;
        let comboTimer = null;
        let currentQuestion = null;
        let gameRunning = true;
        let lastRocketTime = 0;
        let keyboardInput = ''; // For multi-digit number input

        // Audio context
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();

        // Level configuration
        const levels = [
            { min: 1, max: 5, name: "1er-5er Reihe", speed: 1.5, spawnRate: 3000 },
            { min: 1, max: 7, name: "1er-7er Reihe", speed: 1.8, spawnRate: 2800 },
            { min: 1, max: 10, name: "Alle Reihen", speed: 2.0, spawnRate: 2500 }
        ];

        // Star class
        class Star {
            constructor() {
                this.x = Math.random() * canvas.width;
                this.y = Math.random() * canvas.height;
                this.size = Math.random() * 2;
                this.brightness = Math.random();
                this.twinkleSpeed = Math.random() * 0.05 + 0.01;
            }

            update() {
                this.brightness += this.twinkleSpeed;
                if (this.brightness > 1 || this.brightness < 0) {
                    this.twinkleSpeed *= -1;
                }
            }

            draw() {
                ctx.fillStyle = `rgba(255, 255, 255, ${this.brightness})`;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        // Planet class
        class Planet {
            constructor(x, y, radius, color, ringColor = null) {
                this.x = x;
                this.y = y;
                this.radius = radius;
                this.color = color;
                this.ringColor = ringColor;
            }

            draw() {
                // Draw planet
                const gradient = ctx.createRadialGradient(
                    this.x - this.radius * 0.3,
                    this.y - this.radius * 0.3,
                    this.radius * 0.1,
                    this.x,
                    this.y,
                    this.radius
                );
                gradient.addColorStop(0, this.lighten(this.color, 40));
                gradient.addColorStop(1, this.color);

                ctx.fillStyle = gradient;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fill();

                // Draw ring if exists (like Saturn)
                if (this.ringColor) {
                    ctx.strokeStyle = this.ringColor;
                    ctx.lineWidth = this.radius * 0.3;
                    ctx.beginPath();
                    ctx.ellipse(this.x, this.y, this.radius * 1.5, this.radius * 0.5, 0, 0, Math.PI * 2);
                    ctx.stroke();
                }
            }

            lighten(color, percent) {
                const num = parseInt(color.replace("#",""), 16);
                const amt = Math.round(2.55 * percent);
                const R = Math.min(255, (num >> 16) + amt);
                const G = Math.min(255, (num >> 8 & 0x00FF) + amt);
                const B = Math.min(255, (num & 0x0000FF) + amt);
                return `rgb(${R},${G},${B})`;
            }
        }

        // Rocket class
        class Rocket {
            constructor(a, b) {
                this.x = -100;
                this.y = Math.random() * (canvas.height - 200) + 100;
                this.a = a;
                this.b = b;
                this.answer = a * b;
                this.speed = levels[currentLevel - 1].speed;
                this.width = 100;
                this.height = 40;
                this.color = this.getRandomColor();
                this.flames = [];
            }

            getRandomColor() {
                const colors = ['#e74c3c', '#3498db', '#f39c12', '#2ecc71', '#9b59b6'];
                return colors[Math.floor(Math.random() * colors.length)];
            }

            update() {
                this.x += this.speed;

                // Add flame particle
                if (Math.random() < 0.3) {
                    this.flames.push({
                        x: this.x,
                        y: this.y + (Math.random() - 0.5) * 20,
                        life: 1.0,
                        size: Math.random() * 10 + 5
                    });
                }

                // Update flames
                this.flames.forEach(flame => {
                    flame.x -= 2;
                    flame.life -= 0.05;
                });
                this.flames = this.flames.filter(f => f.life > 0);
            }

            draw() {
                // Draw flames
                this.flames.forEach(flame => {
                    const gradient = ctx.createRadialGradient(
                        flame.x, flame.y, 0,
                        flame.x, flame.y, flame.size
                    );
                    gradient.addColorStop(0, `rgba(255, 255, 100, ${flame.life})`);
                    gradient.addColorStop(0.5, `rgba(255, 150, 50, ${flame.life * 0.8})`);
                    gradient.addColorStop(1, `rgba(255, 50, 0, 0)`);

                    ctx.fillStyle = gradient;
                    ctx.beginPath();
                    ctx.arc(flame.x, flame.y, flame.size, 0, Math.PI * 2);
                    ctx.fill();
                });

                ctx.save();
                ctx.translate(this.x + this.width / 2, this.y);

                // Rocket body
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.moveTo(-40, -15);
                ctx.lineTo(40, -15);
                ctx.lineTo(50, 0);
                ctx.lineTo(40, 15);
                ctx.lineTo(-40, 15);
                ctx.closePath();
                ctx.fill();

                // Rocket nose
                ctx.fillStyle = '#e74c3c';
                ctx.beginPath();
                ctx.moveTo(40, -15);
                ctx.lineTo(60, 0);
                ctx.lineTo(40, 15);
                ctx.closePath();
                ctx.fill();

                // Window
                ctx.fillStyle = '#5dade2';
                ctx.beginPath();
                ctx.arc(10, 0, 10, 0, Math.PI * 2);
                ctx.fill();

                ctx.strokeStyle = '#2980b9';
                ctx.lineWidth = 2;
                ctx.stroke();

                // Fins
                ctx.fillStyle = '#c0392b';
                ctx.beginPath();
                ctx.moveTo(-40, 15);
                ctx.lineTo(-50, 25);
                ctx.lineTo(-30, 15);
                ctx.closePath();
                ctx.fill();

                ctx.beginPath();
                ctx.moveTo(-40, -15);
                ctx.lineTo(-50, -25);
                ctx.lineTo(-30, -15);
                ctx.closePath();
                ctx.fill();

                // Text
                ctx.fillStyle = 'white';
                ctx.font = 'bold 20px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.strokeStyle = '#000';
                ctx.lineWidth = 3;
                ctx.strokeText(`${this.a} √ó ${this.b}`, 0, 0);
                ctx.fillText(`${this.a} √ó ${this.b}`, 0, 0);

                ctx.restore();
            }

            isOffScreen() {
                return this.x > canvas.width + 100;
            }
        }

        // Explosion class
        class Explosion {
            constructor(x, y, isSuccess = true) {
                this.x = x;
                this.y = y;
                this.particles = [];
                this.isSuccess = isSuccess;

                for (let i = 0; i < (isSuccess ? 60 : 30); i++) {
                    const angle = Math.random() * Math.PI * 2;
                    const speed = Math.random() * 8 + 3;
                    this.particles.push({
                        x: x,
                        y: y,
                        vx: Math.cos(angle) * speed,
                        vy: Math.sin(angle) * speed,
                        life: 1.0,
                        size: Math.random() * 6 + 3,
                        color: isSuccess ?
                            `hsl(${Math.random() * 60 + 40}, 100%, 60%)` :
                            `hsl(0, 100%, 50%)`
                    });
                }
            }

            update() {
                this.particles.forEach(p => {
                    p.x += p.vx;
                    p.y += p.vy;
                    p.vy += 0.2; // Gravity
                    p.life -= 0.02;
                });
                this.particles = this.particles.filter(p => p.life > 0);
            }

            draw() {
                this.particles.forEach(p => {
                    ctx.fillStyle = p.color.replace(')', `, ${p.life})`).replace('hsl', 'hsla');
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                    ctx.fill();

                    // Add glow for successful explosions
                    if (this.isSuccess) {
                        ctx.shadowBlur = 20;
                        ctx.shadowColor = p.color;
                        ctx.fill();
                        ctx.shadowBlur = 0;
                    }
                });
            }

            isDead() {
                return this.particles.length === 0;
            }
        }

        // Initialize stars
        function initStars() {
            stars = [];
            for (let i = 0; i < 150; i++) {
                stars.push(new Star());
            }
        }

        // Initialize planets
        function initPlanets() {
            planets = [
                new Planet(150, 150, 40, '#e74c3c'),
                new Planet(800, 500, 60, '#f39c12', '#d68910'),
                new Planet(900, 200, 30, '#3498db')
            ];
        }

        // Spawn rocket
        function spawnRocket() {
            const level = levels[currentLevel - 1];
            const a = Math.floor(Math.random() * level.max) + 1;
            const b = Math.floor(Math.random() * 10) + 1;
            rockets.push(new Rocket(a, b));
        }

        // Update keyboard input display
        function updateKeyboardDisplay() {
            const display = document.getElementById('keyboardInputDisplay');
            display.textContent = keyboardInput || '_';
        }

        // Show question panel
        function showQuestion(rocket) {
            currentQuestion = rocket;
            gameRunning = false;
            keyboardInput = ''; // Reset keyboard input
            updateKeyboardDisplay();

            const panel = document.getElementById('answerPanel');
            const questionText = document.getElementById('questionText');
            const buttonsDiv = document.getElementById('answerButtons');

            questionText.textContent = `${rocket.a} √ó ${rocket.b} = ?`;

            // Generate answers
            const answers = [rocket.answer];
            while (answers.length < 4) {
                const offset = Math.floor(Math.random() * 20) - 10;
                const wrong = rocket.answer + offset;
                if (wrong > 0 && wrong <= 100 && !answers.includes(wrong)) {
                    answers.push(wrong);
                }
            }

            // Shuffle
            answers.sort(() => Math.random() - 0.5);

            // Create buttons
            buttonsDiv.innerHTML = '';
            answers.forEach(answer => {
                const btn = document.createElement('button');
                btn.className = 'answerBtn';
                btn.textContent = answer;
                btn.onclick = () => checkAnswer(answer);
                buttonsDiv.appendChild(btn);
            });

            panel.style.display = 'block';
        }

        // Check answer
        function checkAnswer(answer) {
            const panel = document.getElementById('answerPanel');
            panel.style.display = 'none';

            const isCorrect = answer === currentQuestion.answer;

            if (isCorrect) {
                // Success
                hits++;
                combo++;
                score += currentLevel * 10 * combo;

                explosions.push(new Explosion(currentQuestion.x, currentQuestion.y, true));
                playSuccessSound();
                showCombo(currentQuestion.x, currentQuestion.y);

                // Remove rocket
                rockets = rockets.filter(r => r !== currentQuestion);

                // Check level up
                if (hits % 10 === 0 && currentLevel < 3) {
                    currentLevel++;
                    showMessage(`üéâ Level ${currentLevel}!<br>${levels[currentLevel - 1].name}`);
                }

                // Reset combo timer
                if (comboTimer) clearTimeout(comboTimer);
                comboTimer = setTimeout(() => {
                    combo = 0;
                    updateStats();
                }, 3000);
            } else {
                // Failure
                combo = 0;
                playErrorSound();
            }

            updateStats();
            gameRunning = true;
            currentQuestion = null;
        }

        // Show combo
        function showCombo(x, y) {
            if (combo <= 1) return;

            const comboDiv = document.createElement('div');
            comboDiv.className = 'combo';
            comboDiv.textContent = `${combo}x COMBO!`;
            comboDiv.style.left = x + 'px';
            comboDiv.style.top = y + 'px';
            document.body.appendChild(comboDiv);

            setTimeout(() => comboDiv.remove(), 1000);
        }

        // Show message
        function showMessage(text) {
            const msg = document.getElementById('message');
            msg.innerHTML = text;
            msg.style.display = 'block';
            setTimeout(() => {
                msg.style.display = 'none';
            }, 2000);
        }

        // Update stats
        function updateStats() {
            document.getElementById('levelDisplay').textContent =
                `Level ${currentLevel}: ${levels[currentLevel - 1].name}`;
            document.getElementById('score').textContent = score;
            document.getElementById('combo').textContent = combo;
            document.getElementById('hits').textContent = hits;
        }

        // Sound effects
        function playSuccessSound() {
            const notes = [523.25, 659.25, 783.99]; // C5, E5, G5
            notes.forEach((freq, i) => {
                const osc = audioContext.createOscillator();
                const gain = audioContext.createGain();
                osc.connect(gain);
                gain.connect(audioContext.destination);

                osc.frequency.value = freq;
                osc.type = 'sine';
                const startTime = audioContext.currentTime + (i * 0.1);
                gain.gain.setValueAtTime(0.2, startTime);
                gain.gain.exponentialRampToValueAtTime(0.01, startTime + 0.3);

                osc.start(startTime);
                osc.stop(startTime + 0.3);
            });
        }

        function playErrorSound() {
            const osc = audioContext.createOscillator();
            const gain = audioContext.createGain();
            osc.connect(gain);
            gain.connect(audioContext.destination);

            osc.frequency.value = 150;
            osc.type = 'sawtooth';
            gain.gain.setValueAtTime(0.2, audioContext.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);

            osc.start(audioContext.currentTime);
            osc.stop(audioContext.currentTime + 0.3);
        }

        // Game loop
        function gameLoop() {
            // Clear canvas
            ctx.fillStyle = '#0a0a2e';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw stars
            stars.forEach(star => {
                star.update();
                star.draw();
            });

            // Draw planets
            planets.forEach(planet => planet.draw());

            if (gameRunning) {
                // Spawn rockets
                const now = Date.now();
                if (now - lastRocketTime > levels[currentLevel - 1].spawnRate) {
                    spawnRocket();
                    lastRocketTime = now;
                }

                // Update rockets
                rockets.forEach((rocket, index) => {
                    rocket.update();
                    rocket.draw();

                    // Check if clicked position
                    if (rocket.x > canvas.width / 2 - 50 && !currentQuestion) {
                        showQuestion(rocket);
                    }

                    // Remove off-screen rockets
                    if (rocket.isOffScreen()) {
                        rockets.splice(index, 1);
                        combo = 0;
                        updateStats();
                    }
                });
            } else {
                // Still draw existing rockets
                rockets.forEach(rocket => rocket.draw());
            }

            // Update explosions
            explosions.forEach((explosion, index) => {
                explosion.update();
                explosion.draw();
                if (explosion.isDead()) {
                    explosions.splice(index, 1);
                }
            });

            requestAnimationFrame(gameLoop);
        }

        // Reset game
        function resetGame() {
            rockets = [];
            explosions = [];
            currentLevel = 1;
            score = 0;
            hits = 0;
            combo = 0;
            gameRunning = true;
            lastRocketTime = 0;
            document.getElementById('answerPanel').style.display = 'none';
            updateStats();
        }

        // Keyboard controls
        document.addEventListener('keydown', (e) => {
            if (e.key === 'r' || e.key === 'R') {
                resetGame();
                return;
            }

            // Only process other keys when question is active
            if (!currentQuestion) return;

            // Handle number input (0-9)
            if (e.key >= '0' && e.key <= '9') {
                // Limit to 3 digits (max answer is 100)
                if (keyboardInput.length < 3) {
                    keyboardInput += e.key;
                    updateKeyboardDisplay();
                }
                e.preventDefault();
            }
            // Handle backspace
            else if (e.key === 'Backspace') {
                keyboardInput = keyboardInput.slice(0, -1);
                updateKeyboardDisplay();
                e.preventDefault();
            }
            // Handle Enter to submit answer
            else if (e.key === 'Enter' && keyboardInput.length > 0) {
                const answer = parseInt(keyboardInput, 10);
                checkAnswer(answer);
                e.preventDefault();
            }
        });

        // Click to enable audio
        canvas.addEventListener('click', () => {
            if (audioContext.state === 'suspended') {
                audioContext.resume();
            }
        }, { once: true });

        // Initialize and start
        initStars();
        initPlanets();
        updateStats();
        gameLoop();

        console.log('üöÄ Raketen-Mathe ready!');
    </script>
</body>
</html>
